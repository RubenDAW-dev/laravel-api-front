<section class="max-w-3xl mx-auto px-6 py-12 bg-white rounded shadow">

  <!-- Loading -->
  @if (cargando()) {
    <p class="text-center text-gray-500">Cargando…</p>
  } @else {

    <!-- Error -->
    @if (error(); as err) {
      <div class="text-center text-red-600 mb-4">{{ err }}</div>
    } @else {

      @if (peticion(); as p) {

        <article class="flex flex-col items-center text-center">

          <!-- Imagen circular -->
          <img [src]="getImg()" alt="Imagen de la petición"
               class="w-40 h-40 object-cover rounded-full border border-gray-200 shadow-sm mb-6" />

          <!-- Título -->
          <h2 class="text-3xl font-bold text-gray-800 mb-4">{{ p.titulo }}</h2>

          <!-- Destinatario -->
          <p class="text-gray-600 mb-2">
            <strong>Destinatario:</strong> {{ p.destinatario }}
          </p>

          <!-- Descripción -->
          <p class="text-gray-700 mb-4">{{ p.descripcion }}</p>

          <!-- Meta info -->
          <p class="text-gray-500 text-sm mb-4">
            <strong>Categoría:</strong> {{ p.categoria?.nombre ?? ('#' + p.categoria_id) }}
            &nbsp;•&nbsp;
            <strong>Firmantes:</strong> {{ p.firmantes ?? 0 }}
            &nbsp;•&nbsp;
            <strong>Autor:</strong> {{ p.user?.name ?? ('user #' + p.user_id) }}
          </p>

          <!-- Toast / mensaje de firma -->
          @if (toast(); as t) {
            <div class="text-green-600 mb-4 font-medium">{{ t }}</div>
          }

          <!-- Acciones -->
          <div class="flex flex-wrap justify-center gap-4 mb-6">
            <button type="button"
                    (click)="firmar()"
                    [disabled]="firmando() || yaFirmada()"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded transition-transform transform hover:-translate-y-0.5 disabled:opacity-50">
              @if (yaFirmada()) { Ya firmaste }
              @else if (firmando()) { Firmando… }
              @else { Firmar }
            </button>

            @if (esDueno()) {
              <a [routerLink]="['/peticiones/edit', p.id]"
                 class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-6 rounded transition-transform transform hover:-translate-y-0.5">
                Editar
              </a>
              <button type="button" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-6 rounded transition-transform transform hover:-translate-y-0.5"
                      (click)="borrar()">
                Borrar
              </button>
            }
          </div>

          <!-- Volver -->
          <div>
            <a routerLink="/peticiones" class="text-gray-600 hover:text-gray-800 underline">
              ← Volver al listado
            </a>
          </div>

        </article>

      } @else {
        <p class="text-center text-gray-600">No se encontró la petición.</p>
      }

    }
  }
</section>
